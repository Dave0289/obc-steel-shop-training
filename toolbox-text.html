<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weekly Safety Toolbox Talk</title>

  <style>
    :root{
      --bg:#f4f6f8;
      --card:#ffffff;
      --ink:#111827;
      --muted:#6b7280;
      --btn:#2563eb;
      --border:#e5e7eb;
      --radius:16px;
      --shadow:0 12px 35px rgba(0,0,0,.12);
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:var(--bg);
      padding:18px;
    }

    .wrap{
      width:min(980px, 100%);
      margin:0 auto;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }

    .title{
      margin:0;
      font-size:22px;
      line-height:1.2;
    }

    .back{
      text-decoration:none;
      color:var(--ink);
      border:1px solid var(--border);
      padding:10px 12px;
      border-radius:999px;
      background:#fff;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }

    .sectionTitle{
      margin:0 0 8px 0;
      font-size:16px;
    }

    .talk{
      border:1px solid var(--border);
      border-radius:12px;
      padding:14px;
      background:#fafafa;
      line-height:1.35;
      font-size:15px;
      white-space:pre-wrap;
      overflow-wrap:anywhere;
      min-height:220px;
    }

    .form{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }

    label{
      font-size:14px;
      color:var(--muted);
    }

    input[type="text"]{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      font-size:16px;
    }

    .row{
      display:flex;
      align-items:flex-start;
      gap:10px;
    }

    .row input{
      margin-top:4px;
      transform:scale(1.2);
    }

    .btn{
      width:100%;
      padding:12px 14px;
      border:none;
      border-radius:12px;
      background:var(--btn);
      color:#fff;
      font-size:16px;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <h1 class="title">Weekly Safety Toolbox Talk</h1>
      <a class="back" href="/index.html">← Back to Portal</a>
    </div>

    <div class="card">
      <h2 class="sectionTitle">Toolbox Talk (English + Español)</h2>
      <div id="talk" class="talk">Loading toolbox talk…</div>

      <div class="form">
        <div>
          <label for="name">Employee Name</label>
          <input id="name" type="text" placeholder="Type your full name" />
        </div>

        <div class="row">
          <input id="ack" type="checkbox" />
          <label for="ack">
            I acknowledge that I have read and understood today’s Weekly Safety Toolbox Talk.
          </label>
        </div>

        <button id="sendBtn" class="btn" type="button">Send Acknowledgment Email</button>
      </div>
    </div>
  </div>

  <script>
    const TO_EMAIL = "dave@ogdenbrothers.com";
    const TALK_TXT_URL = "toolbox-talk.txt";
    let toolboxText = "";

    function todayISO(){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      return `${yyyy}-${mm}-${dd}`;
    }

    async function loadTalk(){
      try{
        const res = await fetch(`${TALK_TXT_URL}?v=${Date.now()}`, { cache: "no-store" });
        if(!res.ok) throw new Error("Fetch failed");
        toolboxText = await res.text();
        document.getElementById("talk").textContent = toolboxText.trim() || "(Toolbox talk file is empty.)";
      }catch(e){
        document.getElementById("talk").textContent =
          "ERROR: Could not load toolbox-talk.txt.\n\n" +
          "Make sure toolbox-talk.txt is in the same folder as toolbox-text.html.";
      }
    }

    function sendEmail(){
      const name = document.getElementById("name").value.trim();
      const ack = document.getElementById("ack").checked;

      if(!name){
        alert("Please enter your name.");
        return;
      }
      if(!ack){
        alert("Please check the acknowledgment box.");
        return;
      }

      const date = todayISO();
      const subject = `OBC Safety Training - Weekly Toolbox Talk - ${name} - ${date}`;

      const body =
`Employee Name: ${name}
Date: ${date}

I acknowledge that I have read and understood today’s Weekly Safety Toolbox Talk.

------------------------------------------------------------
Toolbox Talk (English + Español):
------------------------------------------------------------
${toolboxText || "(Unable to load toolbox talk text.)"}
`;

      const mailto =
        `mailto:${encodeURIComponent(TO_EMAIL)}` +
        `?subject=${encodeURIComponent(subject)}` +
        `&body=${encodeURIComponent(body)}`;

      window.location.href = mailto;
    }

    document.getElementById("sendBtn").addEventListener("click", sendEmail);
    loadTalk();
  </script>
</body>
</html>
