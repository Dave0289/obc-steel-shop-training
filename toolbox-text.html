<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weekly Safety Toolbox Talk</title>

  <style>
    :root{
      --bg:#f4f6f8;
      --card:#ffffff;
      --ink:#111827;
      --muted:#6b7280;
      --btn:#2563eb;
      --border:#e5e7eb;
      --radius:16px;
      --shadow:0 12px 35px rgba(0,0,0,.12);

      /* success banner */
      --ok-bg:#dcfce7;
      --ok-border:#22c55e;
      --ok-text:#166534;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:var(--bg);
      padding:16px;
    }

    .wrap{
      width:min(980px, 100%);
      margin:0 auto;
    }

    .success{
      display:none;
      background:var(--ok-bg);
      border:1px solid var(--ok-border);
      color:var(--ok-text);
      padding:12px 14px;
      border-radius:12px;
      margin-bottom:14px;
      font-size:14px;
      font-weight:600;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }

    h1{
      margin:0;
      font-size:22px;
    }

    .back{
      text-decoration:none;
      color:var(--ink);
      border:1px solid var(--border);
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      font-size:14px;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }

    .talk{
      border:1px solid var(--border);
      border-radius:12px;
      padding:14px;
      background:#fafafa;
      white-space:pre-wrap;
      line-height:1.35;
      font-size:15px;
      min-height:200px;
    }

    .form{
      margin-top:14px;
      display:grid;
      gap:10px;
    }

    label{
      font-size:14px;
      color:var(--muted);
    }

    input[type="text"]{
      width:100%;
      padding:12px;
      border:1px solid var(--border);
      border-radius:12px;
      font-size:16px;
    }

    .row{
      display:flex;
      gap:10px;
      align-items:flex-start;
    }

    .row input{
      margin-top:4px;
      transform:scale(1.2);
    }

    .btn{
      width:100%;
      padding:12px;
      border:none;
      border-radius:12px;
      background:var(--btn);
      color:#fff;
      font-size:16px;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- SUCCESS BANNER (MATCHES TRAINING MODULES) -->
    <div id="successMsg" class="success">
      ✔ Training Submitted
    </div>

    <div class="topbar">
      <h1>Weekly Safety Toolbox Talk</h1>
      <a class="back" href="/index.html">← Back to Portal</a>
    </div>

    <div class="card">
      <div id="talk" class="talk">Loading toolbox talk…</div>

      <div class="form">
        <div>
          <label for="name">Employee Name</label>
          <input id="name" type="text" placeholder="Type your full name" />
        </div>

        <div class="row">
          <input id="ack" type="checkbox" />
          <label for="ack">
            I acknowledge that I have read and understood today’s Weekly Safety Toolbox Talk.
          </label>
        </div>

        <button class="btn" onclick="sendEmail()">Send Acknowledgment</button>
      </div>
    </div>

  </div>

  <script>
    const EMAIL_TO = "dave@ogdenbrothers.com";
    const TALK_FILE = "toolbox-talk.txt";

    let talkText = "";

    function today(){
      const d = new Date();
      return d.toISOString().split("T")[0];
    }

    async function loadTalk(){
      try{
        const res = await fetch(`${TALK_FILE}?v=${Date.now()}`, { cache:"no-store" });
        talkText = await res.text();
        document.getElementById("talk").textContent =
          talkText.trim() || "(Toolbox talk file is empty)";
      }catch{
        document.getElementById("talk").textContent =
          "ERROR: toolbox-talk.txt not found.";
      }
    }

    function sendEmail(){
      const name = document.getElementById("name").value.trim();
      const ack  = document.getElementById("ack").checked;

      if(!name){
        alert("Please enter your name.");
        return;
      }
      if(!ack){
        alert("Please check the acknowledgment box.");
        return;
      }

      const date = today();
      const subject = `OBC Safety Training - Weekly Toolbox Talk - ${name} - ${date}`;

      const body =
`Employee Name: ${name}
Date: ${date}

I acknowledge that I have read and understood today’s Weekly Safety Toolbox Talk.

------------------------------------
${talkText}
`;

      const mailto =
        `mailto:${EMAIL_TO}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

      // SHOW GREEN CONFIRMATION (LIKE MODULES)
      document.getElementById("successMsg").style.display = "block";

      // TRIGGER EMAIL CLIENT
      window.location.href = mailto;
    }

    loadTalk();
  </script>
</body>
</html>
